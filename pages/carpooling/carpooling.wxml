<view class="container">
  <custom-nav title="找车" bg-color="#ffffff" text-color="#000000" />

  <view class="date-tabs-container">
    <view class="date-tabs">
      <view class="tab-item {{ activeDateTab === 0 ? 'active' : '' }}" bindtap="onSwitchDate" data-index="0">今天发车</view>
      <view class="tab-item {{ activeDateTab === 1 ? 'active' : '' }}" bindtap="onSwitchDate" data-index="1">明天发车</view>
    </view>
  </view>

  <view class="filter-bar-wrapper">
    <view class="time-selector" bindtap="onFilterTime">
      <van-icon name="clock-o" color="#999" size="16px" />
      <text class="placeholder">选择开车时间</text>
    </view>
    <view class="filter-btn" bindtap="openFilterPopup">
      <van-icon name="setting-o" size="20px" color="#666" />
    </view>
  </view>

  <scroll-view scroll-y class="main-content">
    <block wx:for="{{ carpoolList }}" wx:key="id">
      <view class="carpool-card">
        <view class="card-top">
          <view class="user-info">
            <image class="avatar" src="{{item.avatar}}" mode="aspectFill"></image>
            <text class="user-name">{{item.nickname}}</text>
          </view>
          <text class="depart-time {{ item.status === 'full' ? 'time-disabled' : 'time-active' }}">{{item.time}}</text>
        </view>

        <view class="card-route">
          <view class="route-row">
            <view class="route-left">
              <view class="icon-up">上</view>
              <text class="address-text">{{item.startPoint}}</text>
            </view>
            <view class="route-right">
              <view class="status-tag {{item.statusClass}}">{{item.statusText}}</view>
            </view>
          </view>
          
          <view class="route-row">
            <view class="route-left">
              <view class="icon-down">下</view>
              <text class="address-text">{{item.endPoint}}</text>
            </view>
            <view class="route-right">
              <view class="price">¥{{item.price}}<text class="unit">/人</text></view>
            </view>
          </view>
        </view>
      </view>
    </block>

    <view class="bottom-spacer"></view>
  </scroll-view>

  <view class="fab-button" bindtap="onPublish">
    <van-icon name="plus" color="#fff" size="24px" />
  </view>

  <service-menu-modal 
    show="{{ showServiceMenu }}" 
    bind:close="onCloseServiceMenu" 
    bind:select="onSelectService"
  />
</view>

<page-container 
  show="{{ showFilterPopup }}" 
  position="right" 
  custom-style="z-index: 999; height: 100vh; background-color: #F6F7F9;"
  bind:clickoverlay="closeFilter" 
  bind:leave="closeFilter"
>
  <view class="filter-popup-container">
    
    <view class="filter-header">
      <view class="header-btn cancel" bindtap="closeFilter">取消</view>
      <view class="header-title">高级筛选</view>
      <view class="header-btn placeholder"></view>
    </view>

    <scroll-view scroll-y class="filter-scroll-content">
      
      <view class="section-title">开始时间</view>
      
      <view class="time-section-card">
        <view class="date-filter-tabs">
          <view 
            class="date-item {{ selectedDateIndex === index ? 'date-active' : '' }}" 
            wx:for="{{ filterDates }}" 
            wx:key="id"
            bindtap="onSelectFilterDate"
            data-index="{{ index }}"
          >
            {{ item.label }}
          </view>
        </view>

        <view class="time-picker-columns">
          <scroll-view scroll-y class="time-col border-right" show-scrollbar="{{false}}">
            <view 
              class="time-cell {{ selectedHour === item ? 'time-option-active' : '' }}" 
              wx:for="{{ filterHours }}" 
              wx:key="*this"
              bindtap="onSelectFilterHour"
              data-val="{{ item }}"
            >
              {{ item }}
            </view>
          </scroll-view>

          <scroll-view scroll-y class="time-col">
            <view 
              class="time-cell {{ selectedMinute === item ? 'time-option-active' : '' }}" 
              wx:for="{{ filterMinutes }}" 
              wx:key="*this"
              bindtap="onSelectFilterMinute"
              data-val="{{ item }}"
            >
              {{ item }}
            </view>
          </scroll-view>
        </view>
      </view>

      <view class="section-title mt-40">位置选择</view>
      
      <view class="location-card">
        <view class="loc-row">
          <view class="loc-dot dot-start"></view>
          <text class="loc-text text-black">理想城八期西门</text>
        </view>
        <view class="loc-divider"></view>
        <view class="loc-row">
          <view class="loc-dot dot-end"></view>
          <text class="loc-text text-gray">终点</text>
        </view>
      </view>

      <view class="bottom-placeholder"></view>
    </scroll-view>

    <view class="filter-footer-bar">
      <view class="btn btn-reset" bindtap="resetFilter">重置</view>
      <view class="btn btn-save" bindtap="saveFilter">保存筛选</view>
    </view>

  </view>
</page-container>