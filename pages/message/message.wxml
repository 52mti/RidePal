<view class="container">
  <!-- Scenario A: Search + Add | Title | Right Icon -->
  <custom-nav
    title="信息"
    show-search
    show-add
    bg-color="#F6F7F9"
    bind:search="handleSearchClick"
    bind:add="handleAddClick"
  />

  <!-- 消息列表 -->
  <scroll-view scroll-y class="message-list" scroll-with-animation>
    <block wx:for="{{msgList}}" wx:key="id">
      <view class="chat-item" bindtap="goToChat" data-id="{{item.id}}" data-title="{{item.title}}" data-type="{{item.type}}">

        <!-- 头像 -->
        <view class="avatar-wrap">
          <image wx:if="{{item.type !== 'dynamic'}}" class="avatar" src="{{item.avatarUrl}}" />
          <view wx:else class="avatar-dynamic">
            <van-icon name="logistics" size="24px" color="#fff" />
          </view>
          <view class="badge" wx:if="{{item.unread > 0}}">{{item.unread}}</view>
        </view>

        <!-- 内容区 -->
        <view class="content-box">
          <view class="row-top">
            <view class="title-wrap">
              <text class="title {{item.type === 'dynamic' ? 'title-dynamic' : ''}}">{{item.title}}</text>
              <text wx:if="{{item.tag}}" class="tag-role">({{item.tag}})</text>
            </view>
            <text class="time">{{item.updatedTime}}</text>
          </view>

          <!-- 普通消息 -->
          <view wx:if="{{item.type !== 'dynamic'}}" class="row-bottom">
            <text class="msg-text">{{item.content}}</text>
          </view>

          <!-- 拼车动态 -->
          <view wx:else class="dynamic-info">
            <text class="dynamic-detail">车牌：{{item.plateNumber}} {{item.carColor}} {{item.carModel}}</text>
            <view class="dynamic-time-row">
              <van-icon name="clock-o" size="14px" color="#07c160" />
              <text class="dynamic-depart">{{item.departTime}} 开车</text>
            </view>
          </view>
        </view>

      </view>
    </block>

    <van-empty description="暂无消息" wx:if="{{msgList.length === 0 && !loading}}" />
    <view class="loading-text" wx:if="{{loading}}">加载中...</view>
    <view style="height: 160rpx;"></view>
  </scroll-view>

  <!-- 浮动按钮 -->
  <view class="fab" bindtap="handleAddClick">
    <van-icon name="edit" size="26px" color="#fff" />
  </view>

  <service-menu-modal
    show="{{ showServiceMenu }}"
    bind:close="onCloseServiceMenu"
    bind:select="onSelectService"
  />
</view>
